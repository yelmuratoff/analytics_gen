name: Format check

on:
   pull_request:
      branches: [main]

jobs:
   dart-format-check:
      runs-on: ubuntu-latest
      steps:
         - name: Checkout repository
           uses: actions/checkout@v4

         - name: Set up Dart
           uses: dart-lang/setup-dart@v1
           with:
              sdk: stable

         - name: Cache pub dependencies
           uses: actions/cache@v4
           with:
              path: ~/.pub-cache
              key: ${{ runner.os }}-pub-stable-${{ hashFiles('**/pubspec.lock') }}
              restore-keys: |
                 ${{ runner.os }}-pub-stable-
                 ${{ runner.os }}-pub-

         - name: Get dependencies
           run: |
              if [ -f example/pubspec.yaml ]; then
                mv example/pubspec.yaml example/pubspec.yaml.bak
              fi
              dart pub get
              if [ -f example/pubspec.yaml.bak ]; then
                mv example/pubspec.yaml.bak example/pubspec.yaml
              fi

         - name: Check dart format
           run: dart format --output=none --set-exit-if-changed .
